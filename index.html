<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imperial High Command | Galactic Database</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;500;700&family=Orbitron:wght@500;700;900&family=Share+Tech+Mono&family=Antonio:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* ANDOR / HIGH COMMAND PALETTE */
            --iso-white: #f4f4f4;       /* Main Background - Sterile White */
            --iso-off-white: #e6e6e6;   /* Panel Backgrounds */
            --iso-grey: #b0b0b0;        /* Secondary Text */
            --iso-dark: #121212;        /* Primary Text / Borders - Stark Black */
            --iso-alert: #cc0000;       /* Flat Red - No Glow */
            --iso-amber: #ffaa00;       /* Warning / Accent */
            --iso-teal: #4d6e7a;        /* Data / Tech Accents */
            
            /* Function Mappings */
            --bg-main: var(--iso-white);
            --bg-panel: #ffffff;
            --border-heavy: 2px solid var(--iso-dark);
            --border-light: 1px solid #999;
            --text-primary: var(--iso-dark);
            --text-secondary: #555;
            
            /* Faction Colors (Flatted) */
            --faction-hardliner: #d32f2f;
            --faction-traditionalist: #1976d2;
            --faction-ultranationalist: #f57c00;
            --faction-reformer: #388e3c;
        }

        /* CRITICAL STATE OVERRIDE */
        body.alert-state {
            --bg-main: #f0f0f0;
            --iso-dark: #3a0000; /* Dark Red text */
            --border-heavy: 2px solid #cc0000;
        }
        body.alert-state .card { border-color: #cc0000; }
        body.alert-state header { border-bottom-color: #cc0000; }
        body.alert-state aside { border-right-color: #cc0000; }

        * { box-sizing: border-box; margin: 0; padding: 0; cursor: crosshair; }

        /* Scrollbar Styling - Industrial */
        ::-webkit-scrollbar { width: 8px; background: var(--iso-off-white); border-left: 1px solid var(--iso-dark); }
        ::-webkit-scrollbar-thumb { background: var(--iso-dark); border: 1px solid var(--iso-off-white); }
        ::-webkit-scrollbar-thumb:hover { background: var(--iso-alert); }

        body {
            background-color: var(--bg-main);
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            transition: background-color 0.5s ease;
        }

        /* --- LOGIN PAGE (High Command / Andor Style) --- */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: var(--iso-white);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--iso-dark);
            font-family: 'Share Tech Mono', monospace;
            transition: opacity 1s ease-in-out;
        }

        /* Architectural Grid Background */
        .login-grid-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(#ccc 1px, transparent 1px),
                linear-gradient(90deg, #ccc 1px, transparent 1px);
            background-size: 40px 40px;
            opacity: 0.5;
            pointer-events: none;
        }

        .login-container {
            position: relative;
            z-index: 2;
            text-align: center;
            width: 450px;
            background: rgba(255,255,255,0.95);
            border: var(--border-heavy);
            padding: 3rem;
            box-shadow: 15px 15px 0px rgba(0,0,0,0.1);
        }

        .login-header {
            font-family: 'Antonio', sans-serif; /* Tall, imposing font */
            font-weight: 700;
            font-size: 2rem;
            letter-spacing: 2px;
            margin-bottom: 2.5rem;
            text-transform: uppercase;
            border-bottom: 4px solid var(--iso-dark);
            padding-bottom: 10px;
            display: block;
            color: var(--iso-dark);
        }

        /* The Cylinder Port */
        .cylinder-port {
            width: 140px;
            height: 140px;
            border: 6px solid var(--iso-dark);
            border-radius: 50%;
            margin: 0 auto 2rem auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            background: #fff;
        }

        .cylinder-port:hover {
            transform: scale(1.02);
            border-color: var(--iso-alert);
        }
        
        /* Inner mechanism visuals */
        .cylinder-inner {
            width: 85%;
            height: 85%;
            border: 2px dashed #333;
            border-radius: 50%;
            transition: all 0.5s;
            position: relative;
        }
        .cylinder-inner::after {
            content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 10px; height: 10px; background: #333; border-radius: 50%;
        }

        /* Spinning Animation Classes */
        .spinning { animation: spinRandom 0.5s infinite linear; border-style: solid; border-color: var(--iso-amber); }
        .access-granted-ring {
            border-style: solid; background: var(--iso-dark); border-color: var(--iso-dark);
            transform: scale(0.5); opacity: 0; animation: collapseIn 0.5s forwards;
        }

        @keyframes spinRandom {
            0% { transform: rotate(0deg); } 25% { transform: rotate(120deg); }
            50% { transform: rotate(60deg); } 75% { transform: rotate(300deg); } 100% { transform: rotate(360deg); }
        }

        @keyframes collapseIn {
            0% { transform: scale(1.2); opacity: 0; }
            50% { transform: scale(0.9); opacity: 1; }
            100% { transform: scale(1); opacity: 1; background: var(--iso-dark); }
        }

        .login-status {
            font-size: 1rem; letter-spacing: 2px; height: 20px; margin-bottom: 15px; font-weight: bold;
            color: var(--iso-dark);
        }

        .login-instruction {
            font-size: 0.75rem; color: #666; margin-top: 15px; text-transform: uppercase;
            letter-spacing: 1px; border-top: 1px solid #ccc; padding-top: 15px;
        }

        .auth-code-display {
            font-family: 'Share Tech Mono', monospace;
            margin-top: 25px; padding: 15px;
            border: 2px solid var(--iso-dark);
            background: var(--iso-dark); color: var(--iso-white);
            font-size: 1rem; display: none; animation: fadeIn 0.5s forwards;
        }

        /* MANUAL KEYPAD */
        .manual-override-btn {
            background: transparent; border: none; color: #888; text-decoration: underline;
            font-size: 0.7rem; margin-top: 10px; cursor: pointer; font-family: 'Share Tech Mono';
        }
        .keypad-container {
            display: none; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 20px;
        }
        .key-btn {
            background: #eee; border: 1px solid #999; padding: 10px; font-family: 'Orbitron';
            cursor: pointer; transition: 0.2s; font-weight: bold; color: #333;
        }
        .key-btn:hover { background: #333; color: #fff; }
        .key-display { grid-column: 1/-1; background: #222; color: #0f0; padding: 8px; text-align: right; margin-bottom: 5px; font-family: monospace; letter-spacing: 3px; min-height: 35px;}

        /* --- BACKGROUND FX --- */
        .bg-grid {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: 0; pointer-events: none;
        }
        
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 60%, rgba(0,0,0,0.1) 100%);
            z-index: 2; pointer-events: none;
        }

        /* --- BOOT SEQUENCE --- */
        #boot-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--iso-white); z-index: 9999;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            font-family: 'Share Tech Mono', monospace; color: var(--iso-dark);
        }
        .boot-text { 
            font-size: 1.2rem; margin: 5px; text-align: left; width: 500px; 
            border-left: 5px solid var(--iso-dark); padding-left: 10px;
        }

        /* --- LAYOUT --- */
        aside {
            width: 320px; background: #fff; border-right: 2px solid var(--iso-dark);
            display: flex; flex-direction: column; padding: 0; z-index: 10;
            font-family: 'Share Tech Mono', monospace; 
            box-shadow: 5px 0 15px rgba(0,0,0,0.05);
            transition: border-color 0.5s;
        }
        
        .sidebar-section { padding: 1.5rem; border-bottom: 2px solid var(--iso-dark); }
        .sidebar-header {
            color: var(--iso-dark); font-size: 1.2rem; 
            text-transform: uppercase; letter-spacing: 1px;
            font-weight: bold; margin-bottom: 1rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .filter-group { display: flex; flex-direction: column; gap: -1px; } /* Overlapping borders */
        .filter-btn {
            background: #fff; border: 1px solid #ccc; color: #555;
            padding: 10px 12px; font-family: 'Share Tech Mono'; text-transform: uppercase;
            text-align: left; transition: all 0.1s; font-size: 0.85rem;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: -1px;
        }
        .filter-btn:hover { background: #eee; color: #000; z-index: 2; border-color: #999; }
        .filter-btn.active { 
            background: var(--iso-dark); border-color: var(--iso-dark); 
            color: #fff; z-index: 3;
        }
        .filter-count { font-size: 0.7rem; opacity: 0.7; }

        .log-container { 
            flex-grow: 1; overflow-y: auto; padding: 1rem; 
            background: #fcfcfc; border-top: 4px solid var(--iso-dark);
            font-family: 'Share Tech Mono';
        }
        .log-entry { margin-bottom: 4px; padding-left: 8px; font-size: 0.75rem; color: #444; border-left: 2px solid #ddd; }
        .log-entry.new { color: var(--iso-dark); border-left-color: var(--iso-dark); font-weight: bold; }
        .log-entry.alert { color: var(--iso-alert); border-left-color: var(--iso-alert); font-weight: bold; background: rgba(204, 0, 0, 0.05); }

        .comms-input-container {
            padding: 10px; background: #eee; border-top: 1px solid #ccc;
        }
        .comms-input {
            width: 100%; background: #fff; border: 1px solid #999; padding: 5px;
            font-family: 'Share Tech Mono'; font-size: 0.8rem; outline: none;
            color: var(--iso-dark);
        }
        .comms-input::placeholder { color: #888; }
        .search-input {
            width: 100%; background: #fff; border: 1px solid #999; padding: 8px; margin-bottom: 1rem;
            font-family: 'Share Tech Mono'; font-size: 0.8rem; outline: none; color: var(--iso-dark);
        }

        /* --- MAIN CONTENT --- */
        main { 
            flex-grow: 1; overflow-y: auto; position: relative; z-index: 5; 
            padding: 2rem 3rem; display: flex; flex-direction: column; 
        }

        header {
            display: flex; justify-content: space-between; align-items: flex-end;
            border-bottom: 4px solid var(--iso-dark); padding-bottom: 1.5rem; margin-bottom: 2rem;
            position: relative; 
            flex-shrink: 0;
            transition: border-color 0.5s;
        }

        .header-title h1 {
            font-family: 'Antonio', sans-serif; font-size: 3.5rem; text-transform: uppercase; letter-spacing: 2px;
            color: var(--iso-dark); margin-bottom: 0px; line-height: 0.9;
        }
        
        .header-title .subtitle {
            font-family: 'Share Tech Mono', monospace; color: #666; font-size: 0.9rem; letter-spacing: 2px;
            display: flex; align-items: center; margin-bottom: 5px;
        }
        .header-title .subtitle::before { content: ''; display: inline-block; width: 8px; height: 8px; background: var(--iso-dark); margin-right: 10px; }
        
        .header-stats { text-align: right; font-family: 'Share Tech Mono', monospace; font-size: 0.9rem; color: #444; border-right: 1px solid #ccc; padding-right: 20px; line-height: 1.4; display:flex; gap: 20px; align-items: flex-end;}
        .stat-val { color: var(--iso-dark); font-weight: bold; background: #ddd; padding: 0 4px; }
        .stat-hover:hover { background: var(--iso-dark); color: #fff; cursor: help; }

        /* DEFCON WIDGET */
        .threat-level-widget {
            display: flex; flex-direction: column; align-items: flex-end; cursor: pointer;
        }
        .threat-bars { display: flex; gap: 2px; margin-bottom: 4px; }
        .t-bar { width: 12px; height: 20px; background: #ddd; border: 1px solid #999; transition: 0.2s; }
        .threat-label { font-size: 0.7rem; font-weight: bold; color: #666; letter-spacing: 1px; }
        
        .threat-level-widget[data-level="1"] .t-bar:nth-child(1) { background: #4d6e7a; }
        .threat-level-widget[data-level="2"] .t-bar:nth-child(1),
        .threat-level-widget[data-level="2"] .t-bar:nth-child(2) { background: var(--iso-amber); }
        .threat-level-widget[data-level="3"] .t-bar { background: var(--iso-alert); border-color: #500; }
        .threat-level-widget[data-level="3"] .threat-label { color: var(--iso-alert); animation: blink 1s infinite; }
        
        @keyframes blink { 50% { opacity: 0; } }

        /* --- GRID & CARDS (DOSSIER STYLE) --- */
        .grid {
            display: grid; gap: 1.5rem; padding-bottom: 6rem;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        }
        @keyframes cardEnter { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background-color: #fff;
            border: 2px solid var(--iso-dark);
            position: relative;
            transition: all 0.2s ease;
            cursor: pointer; overflow: hidden; height: 100%;
            animation: cardEnter 0.4s ease backwards;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.05);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 8px 8px 0px var(--iso-dark);
            z-index: 10; 
        }

        /* Corner Cutout Effect */
        .card::after {
            content: ''; position: absolute; top: -1px; right: -1px; 
            border-top: 20px solid var(--iso-dark); border-left: 20px solid transparent;
        }

        .card-inner { display: flex; padding: 1.2rem; height: 100%; position: relative; gap: 1rem; }

        .card-visual {
            width: 100px; height: 120px; flex-shrink: 0;
            background: #eee; border: 1px solid #999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; overflow: hidden;
        }
        .card-visual img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%) contrast(120%); mix-blend-mode: multiply; }
        .card:hover .card-visual img { filter: grayscale(0%); mix-blend-mode: normal; }
        
        .imperial-crest { width: 50px; height: 50px; fill: #ccc; z-index: 1; transition: all 0.5s ease; }
        .card:hover .imperial-crest { fill: var(--iso-dark); }
        
        .rank-pips { position: absolute; bottom: 0; left: 0; width: 100%; display: flex; height: 10px; }
        .pip { flex-grow: 1; border-right: 1px solid #fff; }
        .pip.red { background: #cc0000; }
        .pip.blue { background: #003366; }
        .pip.gold { background: #cc9900; }

        .card-data { font-family: 'Exo 2', sans-serif; flex-grow: 1; display: flex; flex-direction: column; }
        
        .data-header { margin-bottom: 0.5rem; border-bottom: 1px solid #ccc; padding-bottom: 5px; display: flex; justify-content: space-between; align-items: flex-start; }
        
        .org-stack { display: flex; flex-direction: column; gap: 4px; }
        .card-org { 
            font-family: 'Share Tech Mono', monospace; color: var(--iso-dark); 
            font-size: 0.7rem; text-transform: uppercase; font-weight: bold;
            background: #ddd; padding: 2px 5px; width: fit-content;
        }
        .faction-tag {
            font-family: 'Exo 2'; font-weight: 800; font-size: 0.6rem; text-transform: uppercase;
            padding: 2px 6px; color: #fff; display: inline-block; width: fit-content;
        }

        .card-name { font-family: 'Antonio', sans-serif; font-size: 1.4rem; font-weight: 700; color: #000; margin-bottom: 2px; line-height: 1; text-transform: uppercase; }
        .card-title { font-size: 0.8rem; color: #666; font-weight: 500; margin-bottom: 8px; display: block; font-style: italic; }
        
        .stats-bars { margin-bottom: 0.8rem; margin-top: auto; }
        .stat-line { display: flex; align-items: center; margin-bottom: 4px; font-family: 'Share Tech Mono', monospace; font-size: 0.65rem; color: #333; }
        .stat-label { width: 60px; text-align: right; margin-right: 8px; }
        .stat-track { flex-grow: 1; height: 6px; background: #e0e0e0; border: 1px solid #999; }
        .stat-fill { height: 100%; background: var(--iso-dark); }
        
        /* Tech Specs Strip at bottom */
        .tech-specs {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: var(--iso-dark); color: #fff;
            font-family: 'Share Tech Mono', monospace; font-size: 0.65rem;
            padding: 2px 10px; display: flex; justify-content: space-between;
        }

        /* --- MODAL (TECHNICAL DRAWING STYLE) --- */
        #modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255, 255, 255, 0.95); backdrop-filter: grayscale(100%); z-index: 1000; 
            display: none; align-items: center; justify-content: center; 
        }
        #modal-overlay.active { display: flex; animation: fadeIn 0.3s forwards; }
        
        .modal-container { 
            width: 90%; max-width: 1100px; height: 80vh; 
            background: #fff; border: 4px solid var(--iso-dark); 
            display: flex; box-shadow: 0 0 50px rgba(0,0,0,0.1); 
            position: relative; animation: modalOpen 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            cursor: move; /* Indicates Draggable */
        }
        
        .modal-left { width: 40%; background: #f0f0f0; border-right: 2px solid var(--iso-dark); display: flex; align-items: center; justify-content: center; position: relative; }
        /* Grid overlay on image */
        .modal-left::before {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            background-image: linear-gradient(#ccc 1px, transparent 1px), linear-gradient(90deg, #ccc 1px, transparent 1px);
            background-size: 20px 20px; pointer-events: none; opacity: 0.5; z-index: 1;
        }

        .modal-img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%); mix-blend-mode: multiply; z-index: 0; }
        
        .modal-right { width: 60%; padding: 3rem; display: flex; flex-direction: column; position: relative; overflow-y: auto; cursor: default; }
        .modal-close { position: absolute; top: 10px; right: 20px; font-family: 'Arial'; font-weight: bold; color: var(--iso-dark); font-size: 3rem; cursor: pointer; line-height: 0.8; }
        .modal-close:hover { color: var(--iso-alert); }
        .modal-print { position: absolute; top: 18px; right: 70px; font-size: 1.2rem; cursor: pointer; color: #888; transition: 0.2s; }
        .modal-print:hover { color: var(--iso-dark); }
        
        .dossier-label { 
            color: #fff; background: var(--iso-dark); padding: 2px 6px; 
            font-family: 'Share Tech Mono'; letter-spacing: 1px; margin-bottom: 10px; 
            font-size: 0.7rem; width: fit-content; 
        }
        .modal-name { font-family: 'Antonio'; font-size: 3rem; color: #000; text-transform: uppercase; line-height: 1; margin-bottom: 5px; }
        .modal-title { color: #555; font-size: 1.2rem; font-family: 'Exo 2'; text-transform: uppercase; margin-bottom: 2rem; border-bottom: 2px solid #000; padding-bottom: 10px; display: block; font-weight: 700; }
        
        .faction-display { margin-bottom: 2rem; border: 1px solid #999; background: #f9f9f9; padding: 20px; display: grid; grid-template-columns: 1fr; gap: 10px; }
        .faction-header { border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        .faction-name { font-family: 'Antonio'; font-size: 1.5rem; font-weight: 800; text-transform: uppercase; color: #000; }
        .faction-quote { font-family: 'Exo 2'; font-style: italic; color: #666; font-size: 1rem; }
        
        .modal-desc { 
            font-family: 'Share Tech Mono'; color: #333; line-height: 1.6; font-size: 1rem; 
            border-left: 4px solid #ccc; padding-left: 1.5rem; margin-bottom: 2rem; 
            white-space: pre-wrap;
            max-height: 250px; 
            overflow-y: auto;
            padding-right: 10px;
        }

        .modal-stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: auto; }
        .m-stat-box { background: #fff; padding: 15px; border: 2px solid #000; box-shadow: 5px 5px 0 #eee; }
        .m-stat-label { color: #888; font-size: 0.7rem; font-family: 'Share Tech Mono'; display: block; margin-bottom: 5px; }
        .m-stat-val { color: #000; font-size: 1.5rem; font-family: 'Antonio'; font-weight: bold; }

        /* Loyalty Graph */
        .loyalty-graph { display: flex; align-items: flex-end; height: 50px; gap: 4px; margin-top: 10px; border-bottom: 1px solid #999; padding-bottom: 2px; }
        .l-bar { width: 10px; background: #ccc; transition: height 0.5s; }
        .l-bar:last-child { background: var(--iso-dark); }

        /* Print Styles */
        @media print {
            body > *:not(#modal-overlay) { display: none !important; }
            #modal-overlay { position: absolute; background: white; width: 100%; height: 100%; z-index: 99999; display: block !important; }
            .modal-container { box-shadow: none; border: 1px solid #000; width: 100%; height: auto; }
            .modal-close, .modal-print, .modal-actions { display: none; }
            .modal-right { padding: 1rem; }
            .modal-name { font-size: 2rem; }
        }

        /* --- TICKER --- */
        .ticker-wrap { position: fixed; bottom: 0; left: 0; width: 100%; height: 40px; background: var(--iso-white); border-top: 4px solid var(--iso-dark); overflow: hidden; z-index: 50; display: flex; align-items: center; font-family: 'Share Tech Mono', monospace; color: var(--iso-dark); font-size: 1rem; text-transform: uppercase; }
        .ticker-title { background: var(--iso-dark); color: #fff; padding: 0 20px; height: 100%; display: flex; align-items: center; font-weight: bold; z-index: 2; }
        .ticker { display: inline-block; white-space: nowrap; padding-left: 100%; animation: ticker 40s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 3rem; }
        .ticker-item::before { content: '/// '; margin-right: 5px; font-weight: bold; }

        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes modalOpen { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }

        @media(max-width: 900px) {
            .modal-container { flex-direction: column; height: 95vh; overflow-y: auto; }
            .modal-left { width: 100%; height: 200px; border-right: none; border-bottom: 2px solid #000; }
            .modal-right { width: 100%; padding: 1.5rem; }
            .grid { grid-template-columns: 1fr; }
            aside { display: none; }
        }
    </style>
</head>
<body>

    <!-- ANDOR STYLE LOGIN PAGE -->
    <div id="login-overlay">
        <div class="login-grid-bg"></div>
        
        <div class="login-container">
            <div class="login-header">Imperial High Command</div>
            
            <!-- Code Cylinder Interface -->
            <div id="cylinder-interface">
                <div class="cylinder-port" id="cylinder-port" onclick="insertCylinder()">
                    <div class="cylinder-inner" id="cylinder-inner"></div>
                </div>
                <div class="login-instruction">INSERT CODE CYLINDER TO PROCEED</div>
            </div>

            <!-- Manual Override Interface (Hidden by default) -->
            <div id="manual-interface" style="display:none;">
                <div class="key-display" id="key-display"></div>
                <div class="keypad-container" style="display:grid;">
                    <button class="key-btn" onclick="pressKey('1')">1</button>
                    <button class="key-btn" onclick="pressKey('2')">2</button>
                    <button class="key-btn" onclick="pressKey('3')">3</button>
                    <button class="key-btn" onclick="pressKey('4')">4</button>
                    <button class="key-btn" onclick="pressKey('5')">5</button>
                    <button class="key-btn" onclick="pressKey('6')">6</button>
                    <button class="key-btn" onclick="pressKey('7')">7</button>
                    <button class="key-btn" onclick="pressKey('8')">8</button>
                    <button class="key-btn" onclick="pressKey('9')">9</button>
                    <button class="key-btn" onclick="pressKey('CLR')">CLR</button>
                    <button class="key-btn" onclick="pressKey('0')">0</button>
                    <button class="key-btn" onclick="pressKey('ENT')">ENT</button>
                </div>
                <div class="login-instruction">ENTER SECURITY CLEARANCE</div>
            </div>

            <button class="manual-override-btn" onclick="toggleManualMode()">[ MANUAL OVERRIDE ]</button>

            <div class="login-status" id="login-status">TERMINAL LOCKED</div>
            
            <div class="auth-code-display" id="auth-code-display">
                AUTH CODE: <span id="generated-code">---</span>
            </div>
        </div>
    </div>

    <!-- MAIN APP CONTENT (Hidden behind login) -->
    <div class="bg-grid"></div>
    <div class="vignette"></div>

    <!-- BOOT SEQUENCE (Runs after login) -->
    <div id="boot-screen">
        <div class="boot-text" id="boot-1">INITIALIZING IMPERIAL KERNEL 6.2...</div>
        <div class="boot-text" id="boot-2">VERIFYING BIOMETRIC SIGNATURE...</div>
        <div class="boot-text" id="boot-3">DECRYPTING PERSONNEL DATABASE...</div>
        <div class="boot-text" id="boot-4" style="font-weight:bold; background: #000; color: #fff; padding: 2px 5px;">ACCESS GRANTED. ERA: 5 ABY.</div>
    </div>

    <!-- MODAL OVERLAY -->
    <div id="modal-overlay" onclick="closeModal(event)">
        <div id="modal-container" class="modal-container" onclick="event.stopPropagation()">
            <div class="modal-close" onclick="closeModal()">×</div>
            <div class="modal-print" onclick="printDossier()"><i class="fas fa-print"></i></div>

            <div class="modal-left">
                <img id="m-img" class="modal-img" src="" alt="Personnel Image">
                <div id="m-svg-container" style="display:none; width:100%; height:100%; align-items:center; justify-content:center; background:#eee;">
                    <svg class="imperial-crest" style="width:150px; height:150px; fill:#333;" viewBox="0 0 512 512">
                        <path id="m-svg-path" d=""/>
                    </svg>
                </div>
            </div>

            <div class="modal-right">
                <div class="dossier-label">IMPERIAL DOSSIER // TOP SECRET</div>
                <h2 id="m-name" class="modal-name">NAME</h2>
                <div id="m-title" class="modal-title">TITLE</div>

                <div class="faction-display">
                    <div class="faction-header">
                        <div id="m-faction-name" class="faction-name">FACTION</div>
                    </div>
                    <div id="m-faction-quote" class="faction-quote">"Quote"</div>
                    <div class="faction-agenda"><span style="font-weight:bold; font-size:0.7rem;">AGENDA:</span> <span id="m-faction-agenda">Agenda Text</span></div>
                </div>
                
                <div style="font-family:'Antonio'; font-weight:bold; margin-bottom:10px; border-bottom:1px solid #ccc;">BIOGRAPHICAL SUMMARY</div>
                <p id="m-desc" class="modal-desc">Description text...</p>

                <div class="modal-stats-grid">
                    <div class="m-stat-box">
                        <span class="m-stat-label">CURRENT LOCATION</span>
                        <span id="m-loc" class="m-stat-val">CORUSCANT</span>
                    </div>
                    <div class="m-stat-box">
                        <span class="m-stat-label">HISTORICAL LOYALTY TRACKING</span>
                        <div class="loyalty-graph" id="loyalty-graph">
                            <!-- Injected JS -->
                        </div>
                        <span id="m-loyalty" class="m-stat-val" style="font-size:1rem; margin-top:5px; display:block;">98%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SIDEBAR WITH FILTERS AND LOGS -->
    <aside>
        <div class="sidebar-section" style="background: #e9e9e9;">
            <div class="sidebar-header">
                <span>FILTER DATABASE</span>
                <i class="fas fa-filter" style="font-size:0.8rem"></i>
            </div>
            
            <!-- SEARCH INPUT -->
            <input type="text" id="search-bar" class="search-input" placeholder="SEARCH ID/NAME..." onkeyup="handleSearch()">
            
            <div class="filter-group">
                <button class="filter-btn active" onclick="filterData('all', this)">
                    All Records <span class="filter-count" id="count-all">0</span>
                </button>
            </div>
            
            <div style="margin:15px 0 5px 0; color:#000; font-weight:bold; font-size:0.7rem; font-family:'Share Tech Mono'">ORGANIZATION</div>
            <div class="filter-group">
                <button class="filter-btn" onclick="filterData('org', this, 'High Command')">
                    High Command <span class="filter-count" id="count-mil">0</span>
                </button>
                <button class="filter-btn" onclick="filterData('org', this, 'Ministry')">
                    Ministries <span class="filter-count" id="count-min">0</span>
                </button>
                <button class="filter-btn" onclick="filterData('org', this, 'Ruling Council')">
                    Ruling Council <span class="filter-count" id="count-cou">0</span>
                </button>
                <button class="filter-btn" onclick="filterData('org', this, 'COMPNOR')">
                    COMPNOR / Party <span class="filter-count" id="count-com">0</span>
                </button>
                <button class="filter-btn" onclick="filterData('org', this, 'Security')">
                    Intel / Security <span class="filter-count" id="count-sec">0</span>
                </button>
                <button class="filter-btn" onclick="filterData('org', this, 'Provincial')">
                    Provincial / Moffs <span class="filter-count" id="count-pro">0</span>
                </button>
            </div>

            <div style="margin:15px 0 5px 0; color:#000; font-weight:bold; font-size:0.7rem; font-family:'Share Tech Mono'">POLITICAL FACTION</div>
            <div class="filter-group">
                <button class="filter-btn" onclick="filterData('faction', this, 'Hardliner')">
                    Hardliners <i class="fas fa-square" style="font-size:10px; color:var(--faction-hardliner)"></i>
                </button>
                <button class="filter-btn" onclick="filterData('faction', this, 'Traditionalist')">
                    Traditionalists <i class="fas fa-square" style="font-size:10px; color:var(--faction-traditionalist)"></i>
                </button>
                <button class="filter-btn" onclick="filterData('faction', this, 'Ultranationalist')">
                    Ultranationalists <i class="fas fa-square" style="font-size:10px; color:var(--faction-ultranationalist)"></i>
                </button>
                <button class="filter-btn" onclick="filterData('faction', this, 'Reformer')">
                    Reformers <i class="fas fa-square" style="font-size:10px; color:var(--faction-reformer)"></i>
                </button>
            </div>
        </div>

        <div style="padding: 0.8rem 1.5rem; background: var(--iso-dark); color: #fff; font-size: 0.8rem; font-weight: bold; font-family:'Share Tech Mono'; display:flex; justify-content:space-between; align-items:center;">
            <span>SYSTEM LOGS // TERMINAL 442</span>
            <div style="width:8px; height:8px; background:#0f0; border-radius:50%; box-shadow:0 0 5px #0f0;" id="connection-status"></div>
        </div>
        <div class="log-container" id="system-log"></div>
        <div class="comms-input-container">
            <input type="text" class="comms-input" id="comms-input" placeholder="> BROADCAST TO NET..." onkeypress="handleComms(event)">
        </div>
    </aside>

    <main>
        <header>
            <div class="header-title">
                <div class="subtitle">Galactic Empire // Personnel Database</div>
                <h1>High Command</h1>
            </div>
            
            <div class="header-stats">
                <div class="threat-level-widget" id="threat-widget" data-level="1" onclick="cycleThreatLevel()">
                    <div class="threat-bars">
                        <div class="t-bar"></div>
                        <div class="t-bar"></div>
                        <div class="t-bar"></div>
                    </div>
                    <div class="threat-label" id="threat-text">SEC: NORMAL</div>
                </div>
                
                <div style="display:flex; flex-direction:column; justify-content:space-between; height:100%;">
                    <div>ERA: 5 ABY</div>
                    <div>CYCLE: <span id="stardate" class="stat-hover" onmouseover="showRealTime(true)" onmouseout="showRealTime(false)"></span></div>
                    <div>KEY: <span class="stat-val">TOP SECRET</span></div>
                </div>
            </div>
        </header>

        <div class="grid" id="cardGrid"></div>
    </main>

    <div class="ticker-wrap">
        <div class="ticker-title">HOLONET NEWS</div>
        <div class="ticker" id="ticker-content">
            <!-- Injected via JS -->
        </div>
    </div>

<script>
    // --- DATABASE CONFIGURATION ---
    const personnelConfig = [
        {
            name: "TANRI KETHIAN",
            title: "Grand Vizier",
            org: "Imperial Court",
            displayOrg: "Imperial Throne",
            faction: "Traditionalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=MA&backgroundColor=222", 
            desc: "The Head of State's supreme legal and political executor. Ensures senior officials adhere to Imperial doctrine and the sovereign’s vision. Oversees the Imperial Throne corporate and its many extralegal instrumentalities.",
            status: "active", location: "Imperial Palace", loyalty: 70, influence: 45
        },
        {
            name: "Synnove Fenn",
            title: "Supreme Commander",
            org: "High Command",
            displayOrg: "Galactic Empire",
            faction: "Reformer",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=SF&backgroundColor=300",
            desc: "Head of State. The apex of Imperial authority, uniting political sovereignty and military supremacy. Commands the Empire’s destiny through decree, war direction, and strategic will. All state power ultimately answers to this office.",
            status: "active", location: "Imperial Palace", loyalty: 95, influence: 95
        },
        {
            name: "[REDACTED]",
            title: "Prime Minister",
            org: "Ministry",
            displayOrg: "Council of Ministers",
            faction: "Traditionalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=PM&backgroundColor=111",
            desc: "Administrative head of the executive government. Coordinates ministries and communicates high-level directives across the bureaucratic machine. Maintains continuity of governance amid crisis and upheaval.",
            status: "idle", location: "Coruscant", loyalty: 85, influence: 70
        },
        {
            name: "Martyn Strickland",
            title: "Minister of Security",
            org: "Ministry",
            displayOrg: "Council of Ministers",
            faction: "Traditionalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=MS&backgroundColor=300",
            desc: "A scared man.",
            status: "alert", location: "Imperial Ministerium", loyalty: 65, influence: 20
        },
        {
            name: "Iuuna Albescu",
            title: "Minister of War",
            org: "Ministry",
            displayOrg: "Council of Ministers",
            faction: "Hardliner",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=WA&backgroundColor=400",
            desc: "sesbian lex elf",
            status: "active", location: "Anaxes", loyalty: 80, influence: 60
        },
        {
            name: "[REDACTED]",
            title: "Minister of Justice",
            org: "Ministry",
            displayOrg: "Council of Ministers",
            faction: "Hardliner",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=MJ&backgroundColor=121",
            desc: "Guardian of Imperial law and state legality. Supervises legal institutions and high courts while ensuring justice operates as an instrument of Imperial authority. Interprets and enforces the Empire’s supreme statutes. As a Hardliner, he views the courts not as independent arbiters but as extensions of the Emperor's will, legitimizing the military junta's seizure of power.",
            status: "idle", location: "Supreme Court", loyalty: 90, influence: 60
        },
        {
            name: "[REDACTED]",
            title: "Lord/Lady President",
            org: "Ruling Council",
            displayOrg: "IMPERIAL RULING COUNCIL",
            faction: "Traditionalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=LP&backgroundColor=010",
            desc: "Senior master of the Ruling Council. Controls Council functions parallel to formal state structures. Operates as a power broker within the Empire’s highest political strata. Has largely replaced the Imperial Senate in authority. He maneuvers to maintain the status quo and protects the interests of the aristocracy, viewing the military's current dominance as a temporary necessity.",
            status: "active", location: "Imperial Palace", loyalty: 85, influence: 85
        },
        {
            name: "Darius Vorne",
            title: "Chairman of the Select Committee",
            org: "COMPNOR",
            displayOrg: "COMPNOR",
            faction: "Traditionalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=CV&backgroundColor=224",
            desc: "Wields sweeping authority to enforce the Emperor’s will via social, political, and ideological channels. Oversees COMPNOR’s vast apparatus and its many subsidiaries. Functions as the Empire’s principal engine of indoctrination and societal control. Vorne believes the Empire is best served by a stable, obedient citizenry achieved through cultural conditioning rather than brute force.",
            status: "alert", location: "COMPNOR HQ", loyalty: 80, influence: 85
        },
        {
            name: "Inquart Teegeeack",
            title: "General-Secretary",
            org: "COMPNOR",
            displayOrg: "New Order Party",
            faction: "Ultranationalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=GT&backgroundColor=840",
            desc: "High priest of New Order ideology and enforcer of doctrinal purity. Shapes the ideological center of Imperial politics. Ensures all party organs remain loyal to the spirit and letter of the New Order. An Ultranationalist ideologue, Teegeeack believes the Empire is the end of history and that doubt is treason. He runs the Party as a parallel state security apparatus.",
            status: "idle", location: "Ralltiir", loyalty: 95, influence: 85
        },
        {
            name: "Veyron Cassius",
            title: "Vice Chief of Naval Operations",
            org: "High Command",
            displayOrg: "IMPERIAL NAVY",
            faction: "Reformer",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=VC&backgroundColor=002",
            desc: "Administrative and operational commander of the Imperial Navy’s daily functioning. Oversees fleet development and naval readiness. Second only to the Empire’s foremost admirals. As a Hardliner, Cassius supports the view that the military is the only institution capable of holding the Empire together. He commands the administrative backbone of the Navy.",
            status: "active", location: "Kuat Yards", loyalty: 75, influence: 90
        },
        {
            name: "Keegan Retloc",
            title: "Vice Chairman of the Joint Chiefs",
            org: "High Command",
            displayOrg: "JOINT CHIEFS OF STAFF",
            faction: "Reformer",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=VR&backgroundColor=311",
            desc: "The attack dog of the Imperial Armed Forces. Effective co-ruler of the Empire with Synnove Fenn. Uniformed political chief of the Imperial defense apparatus, responsible for cracking High Command into shape. Retloc is known for his brutal efficiency in suppressing internal rebellions and overseeing the strategic deployment of Stormtrooper legions.",
            status: "active", location: "Bastion", loyalty: 95, influence: 95
        },
        {
            name: "Maximilian Veers",
            title: "Chief of Staff",
            org: "High Command",
            displayOrg: "IMPERIAL ARMY",
            faction: "Hardliner",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=MV&backgroundColor=333",
            desc: "Leads all ground forces across the Empire. Directs doctrine, personnel, strategy, and operational planning for the Army. Elevated post-Endor to restore Army effectiveness and discipline. General Veers, a veteran of countless campaigns including the Battle of Hoth, prioritizes combined arms warfare and disciplined troop deployment.",
            status: "active", location: "Carida", loyalty: 85, influence: 80
        },
        {
            name: "Ardus Kaine",
            title: "Dean",
            org: "Provincial",
            displayOrg: "COLLEGE OF MOFFS",
            faction: "Traditionalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=DK&backgroundColor=444",
            desc: "Chief steward of sector governors, providing guidance, oversight, and arbitration. Ensures Moffs uphold Imperial doctrine and maintain local stability. Serves as intermediary between regional authority and central command. Kaine protects the collective interests of the Moffs, favoring stable provincial governance over radical upheaval.",
            status: "idle", location: "Coruscant", loyalty: 80, influence: 70
        },
        {
            name: "Garrik Kessler",
            title: "Chairman",
            org: "Provincial",
            displayOrg: "Grand Moffs",
            faction: "Reformer",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=GK&backgroundColor=223",
            desc: "Ensures Grand Moffs enforce Imperial policy, ensure stability, enshrine prosperity, and develop their portfolios in line with Imperial doctrine. Ex officio in control of most military and paramilitary forces in the Empire through leadership of the Grand Moffs. Kessler represents the highest level of regional authority, overseeing vast swathes of space.",
            status: "active", location: "Eriadu", loyalty: 90, influence: 95
        },
        {
            name: "Idris Randd",
            title: "Governor-Superior",
            org: "Provincial",
            displayOrg: "DIET OF GOVERNORS",
            faction: "Traditionalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=GR&backgroundColor=123",
            desc: "Leads the assembly of planetary governors, both Moff and non-Moff. Coordinates regional administration and enforces compliance with central policy. Acts as the Empire’s supreme provincial arbiter. Randd navigates the treacherous political landscape by ensuring core governmental functions—taxation, infrastructure, public works—continue unimpeded.",
            status: "idle", location: "Sector 0", loyalty: 75, influence: 60
        },
        {
            name: "Ysanne Isard",
            title: "Director of Imperial Intelligence",
            org: "Security",
            displayOrg: "IMPERIAL INTELLIGENCE",
            faction: "Traditionalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=DI&backgroundColor=500",
            desc: "Machiavellian head of the vast and secretive Imperial Intelligence Community, as well as the Director of the shadowy Imperial Intelligence Service. Directs all intelligence, surveillance, and counterintelligence efforts within and without the Empire. Isard's network of agents is unmatched, capable of penetrating the highest levels of both the Alliance and internal Imperial factions.",
            status: "alert", location: "Classified", loyalty: 40, influence: 60
        },
        {
            name: "Director Valen Krask",
            title: "Imperial Security Bureau",
            org: "Security",
            displayOrg: "SECURITY BUREAU",
            faction: "Ultranationalist",
            image: "images/882d83f4166d0c037cc47346f92e4089 (1).jpg",
            desc: "Chief security officer of the Empire. Directs, guides, and monitors the Imperial Security Bureau and all other internal civil intelligence and police agencies. Krask embodies the Hardliner agenda of 'law and order.' His ISB safeguards loyalty, suppresses dissent, and roots out treason with omnipresent surveillance and terror.",
            status: "active", location: "ISB Central", loyalty: 100, influence: 70
        },
        {
            name: "Director [REDACTED]",
            title: "Judicial Forces",
            org: "Security",
            displayOrg: "JUDICIAL FORCES",
            faction: "Hardliner",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=DJ&backgroundColor=101",
            desc: "Leads the Empire’s uniformed federal police and judicial enforcement units. Serves as law enforcement’s representative within the intelligence-security triad. Ensures order is maintained through disciplined legal force. The Judicial Forces are the heavy, public presence of Imperial authority on Core Worlds.",
            status: "idle", location: "Coruscant", loyalty: 85, influence: 50
        },
        {
            name: "[REDACTED]",
            title: "Grandmaster/mistress",
            org: "Ruling Council",
            displayOrg: "SECRET ORDER",
            faction: "Ultranationalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=GM&backgroundColor=601",
            desc: "Unseen grand cleric of the late Emperor’s arcane and esoteric adepts. Acts as the sovereign’s hand, prophet, and instrument in esoteric affairs. Extends the Empire's reach into the mystical and unknowable. An Ultranationalist extremist, the Grandmaster views the Empire as a spiritual doctrine made manifest, feared even by High Command.",
            status: "alert", location: "Byss", loyalty: 10, influence: 65
        },
        {
            name: "[REDACTED]",
            title: "Lord/Lady",
            org: "Ruling Council",
            displayOrg: "IMPERIAL COURT",
            faction: "Traditionalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=LC&backgroundColor=202",
            desc: "Ceremonial and political figure within the Emperor’s inner circle. Manages courtly traditions, diplomacy, and elite social order. Serves as a visible embodiment of Imperial prestige. Maintains the complex hierarchy and etiquette of the Imperial Court, a subtle but effective way to maintain the illusion of continuity and stability.",
            status: "idle", location: "Imperial Palace", loyalty: 40, influence: 50
        },
        {
            name: "Taokr Selzen",
            title: "Grand Inquisitor",
            org: "Security",
            displayOrg: "Inquisition",
            faction: "Ultranationalist",
            image: "https://api.dicebear.com/7.x/initials/svg?seed=GI&backgroundColor=800",
            desc: "The Empire’s foremost authority on force-sensitive control. Wields an unlimited charter to hunt, regulate, and contain force users. Answers only to the Emperor and enforces absolute compliance. Selzen aligns with the Ultranationalists, enforcing absolute purity and hunting down any who threaten the Emperor's dark vision.",
            status: "alert", location: "Nur", loyalty: 40, influence: 20
        }
    ];

    const factionData = {
        "Hardliner": { color: "var(--faction-hardliner)", quote: "Total commitment, or total annihilation.", agenda: "Establish unified enforcement rule, mobilize society, subordinate traditional authority to uniformed services." },
        "Traditionalist": { color: "var(--faction-traditionalist)", quote: "This too shall pass.", agenda: "Maintenance of the political, economic, and social status quo. Maintain existing institutions, preserve civilian governance, implement careful incremental reforms, stabilize administration, prevent radical upheaval from any faction." },
        "Ultranationalist": { color: "var(--faction-ultranationalist)", quote: "The galaxy obeys, or the galaxy burns.", agenda: "Enforce ideological purity, crush dissent, punish disloyalty, restore a totally dominant Empire, and punish the galaxy for its insolence." },
        "Reformer": { color: "var(--faction-reformer)", quote: "An Empire that cannot rule justly will not rule at all.", agenda: "End the worst excesses of the Empire, ease discrimination as much as possible, improve accountable governance, reform the bureaucracy, eliminate corruption, restructure the government, allow limited self-rule." },
        "Progressive": { color: "var(--faction-progressive)", quote: "The Emperor is not the Empire.", agenda: "Abolish the monarchy, establish collective or representative executive bodies, restore lawful governance, empower civilian institutions, eliminate arbitrary or tyrannical organs." }
    };

    const imperialCrestPath = "M256,504A248,248,0,1,1,504,256,248.28,248.28,0,0,1,256,504ZM256,46C140.23,46,46,140.23,46,256S140.23,466,256,466,466,371.77,466,256,371.77,46,256,46Zm-39.6,120.4a43.51,43.51,0,1,1,43.51-43.51A43.56,43.56,0,0,1,216.4,166.4Zm79.2,0a43.51,43.51,0,1,1,43.51-43.51A43.56,43.56,0,0,1,295.6,166.4ZM256,192.8a63.2,63.2,0,1,0,63.2,63.2A63.27,63.27,0,0,0,256,192.8ZM119.24,256a43.51,43.51,0,1,1-43.51-43.51A43.56,43.56,0,0,1,119.24,256Zm273.52,0a43.51,43.51,0,1,1,43.51,43.51A43.56,43.56,0,0,1,392.76,256ZM216.4,345.6a43.51,43.51,0,1,1-43.51-43.51A43.56,43.56,0,0,1,216.4,345.6Zm79.2,0a43.51,43.51,0,1,1-43.51-43.51A43.56,43.56,0,0,1,295.6,345.6ZM124,136.63l47.58,19.71a80,80,0,0,0,26.79-26.79L178.65,82A208.6,208.6,0,0,0,124,136.63ZM82,178.65l47.58,19.71a80,80,0,0,0-26.79,26.79L82,333.35A208.6,208.6,0,0,0,178.65,430l19.71-47.58a80,80,0,0,0,26.79,26.79L136.63,388A208.6,208.6,0,0,0,82,333.35ZM388,124l-47.58,19.71a80,80,0,0,0-26.79-26.79L333.35,82A208.6,208.6,0,0,0,388,124Zm42,54.65-47.58,19.71a80,80,0,0,0,26.79,26.79L333.35,178.65A208.6,208.6,0,0,0,430,178.65ZM333.35,430l-19.71-47.58a80,80,0,0,0-26.79,26.79L375.37,388A208.6,208.6,0,0,0,430,333.35Z";

    const headlines = [
        "I WANT THAT TWINK (INQUART) OBLITERATED",
        "VALEN 'TORMENT NEXUS' KRASK",
        "ALL OF THE LIGHTS",
        "GRAND MOFF MOFF MCMOFFFACE",
        "SONIC IS A BITCH ASS MOTHERFUCKER",
        "ASHER HALCYON ASCENDS TO THE THRONE OF EMPEROR",
        "PALPATINE FOUND ALIVE IN A CAVE ON REACH",
        "SYNNOVE 'FINISHED CHARACTER SHEET' FENN"
    ];

    // --- LOGIC ---

    function init() {
        // Boot sequence logic is now triggered AFTER login
        updateFilterCounts();
        renderCards(personnelConfig); // Initial Render
        initTicker();
        startLogs();
        updateStardate();
        setInterval(updateStardate, 1000);
        
        // Draggable Logic
        const modal = document.getElementById('modal-container');
        let isDragging = false;
        let startX, startY, initialX, initialY;

        modal.addEventListener('mousedown', (e) => {
            // Prevent dragging if clicking input or textarea (if any) or scrollbar
            if(e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            
            // Get current transform values or default to 0
            const style = window.getComputedStyle(modal);
            const matrix = new WebKitCSSMatrix(style.transform);
            initialX = matrix.m41;
            initialY = matrix.m42;
            
            modal.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            modal.style.transform = `translate(${initialX + dx}px, ${initialY + dy}px)`;
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            modal.style.cursor = 'move';
        });
    }

    function updateStardate() {
        if(isRealTime) {
            const now = new Date();
            document.getElementById('stardate').innerText = now.toLocaleTimeString();
        } else {
            const day = Math.floor(Math.random() * 365);
            const cycle = Math.floor(Math.random() * 24);
            document.getElementById('stardate').innerText = `35:${cycle}:${day}`;
        }
    }

    let isRealTime = false;
    function showRealTime(bool) {
        isRealTime = bool;
        updateStardate();
    }

    // --- LOGIN LOGIC ---
    let isCylinderInserted = false;
    let manualMode = false;
    let enteredKey = "";

    function toggleManualMode() {
        manualMode = !manualMode;
        const cy = document.getElementById('cylinder-interface');
        const man = document.getElementById('manual-interface');
        if(manualMode) {
            cy.style.display = 'none';
            man.style.display = 'block';
        } else {
            cy.style.display = 'block';
            man.style.display = 'none';
        }
    }

    function pressKey(k) {
        const display = document.getElementById('key-display');
        if(k === 'CLR') {
            enteredKey = "";
        } else if (k === 'ENT') {
            if(enteredKey.length >= 4) {
                grantAccess();
            } else {
                display.innerText = "INVALID LENGTH";
                enteredKey = "";
                setTimeout(() => display.innerText = "", 1000);
                return;
            }
        } else {
            if(enteredKey.length < 8) enteredKey += k;
        }
        display.innerText = enteredKey.replace(/./g, '*');
    }

    function insertCylinder() {
        if(isCylinderInserted) return;
        isCylinderInserted = true;
        
        const inner = document.getElementById('cylinder-inner');
        const status = document.getElementById('login-status');
        
        status.innerText = "AUTHENTICATING...";
        inner.classList.add('spinning');
        status.style.color = "#cc0000";

        setTimeout(() => {
            inner.classList.remove('spinning');
            inner.classList.add('access-granted-ring');
            grantAccess();
        }, 2000);
    }

    function grantAccess() {
        const status = document.getElementById('login-status');
        const authDisplay = document.getElementById('auth-code-display');
        const codeSpan = document.getElementById('generated-code');
        
        status.innerText = "ACCESS GRANTED";
        status.style.color = "#000"; 
        status.style.fontWeight = "900";

        const randomCode = generateAuthCode();
        codeSpan.innerText = randomCode;
        authDisplay.style.display = 'block';

        setTimeout(() => {
            const overlay = document.getElementById('login-overlay');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                document.getElementById('boot-screen').style.display = 'flex';
                runBootSequence();
            }, 1000);
        }, 1500);
    }

    function generateAuthCode() {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let result = "IG-";
        for (let i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
        result += "-";
        for (let i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
        return result;
    }

    // --- INTERACTIVE ELEMENTS ---

    let threatLevel = 1;
    function cycleThreatLevel() {
        threatLevel++;
        if(threatLevel > 3) threatLevel = 1;
        
        const widget = document.getElementById('threat-widget');
        const label = document.getElementById('threat-text');
        const body = document.body;

        widget.setAttribute('data-level', threatLevel);
        
        if(threatLevel === 1) {
            label.innerText = "SEC: NORMAL";
            body.classList.remove('alert-state');
            addLog("SECURITY ALERT LEVEL: NORMAL");
        } else if (threatLevel === 2) {
            label.innerText = "SEC: ELEVATED";
            body.classList.remove('alert-state');
            addLog("SECURITY ALERT LEVEL: ELEVATED");
        } else if (threatLevel === 3) {
            label.innerText = "SEC: CRITICAL";
            body.classList.add('alert-state');
            addLog("SECURITY ALERT LEVEL: CRITICAL - LOCKDOWN PROTOCOLS");
        }
    }

    function handleComms(e) {
        if(e.key === 'Enter') {
            const input = document.getElementById('comms-input');
            if(input.value.trim() !== "") {
                addLog(`[USER]: ${input.value.toUpperCase()}`);
                input.value = "";
            }
        }
    }

    // Search Interaction
    function handleSearch() {
        const query = document.getElementById('search-bar').value.toLowerCase();
        const filtered = personnelConfig.filter(p => p.name.toLowerCase().includes(query) || p.title.toLowerCase().includes(query));
        renderCards(filtered);
    }

    // Print
    function printDossier() {
        window.print();
    }

    function getPips() {
        const types = ['red', 'blue', 'gold'];
        let html = '';
        const count = Math.floor(Math.random() * 4) + 3;
        for(let i=0; i<count; i++) {
            const type = types[Math.floor(Math.random() * types.length)];
            html += `<div class="pip ${type}"></div>`;
        }
        return html;
    }

    function getTechID() { return Math.floor(10000 + Math.random() * 90000); }

    function renderCards(data) {
        const grid = document.getElementById('cardGrid');
        grid.innerHTML = "";
        
        if(data.length === 0) {
            grid.innerHTML = `<div style="color:#000; font-family:'Share Tech Mono'; grid-column: 1/-1; text-align:center; padding-top:50px; font-weight:bold;">NO RECORDS FOUND MATCHING QUERY.</div>`;
            return;
        }

        data.forEach((person, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            // Stagger animation based on filtered index
            card.style.animationDelay = `${index * 50}ms`;
            
            // Find original index in master config for correct modal opening
            const masterIndex = personnelConfig.indexOf(person);
            card.onclick = () => openModal(masterIndex);
            
            const techID = getTechID();
            const pips = getPips();
            const fData = factionData[person.faction] || { color: "#333" };

            // Truncate Description for card
            const rawDesc = person.desc;
            const summaryLength = 120; 
            let summaryDesc = rawDesc.length > summaryLength ? 
                              rawDesc.substring(0, rawDesc.lastIndexOf(' ', summaryLength)) + '...' : rawDesc;

            // Image Handling
            let imgContent = '';
            let fallbackStyle = 'display:block';
            if (person.image && person.image.trim() !== "") {
                imgContent = `<img src="${person.image}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">`;
                fallbackStyle = 'display:none';
            }
            
            card.innerHTML = `
                <div class="card-inner">
                    <div class="card-visual">
                        ${imgContent}
                        <svg class="imperial-crest" style="${fallbackStyle}" viewBox="0 0 512 512">
                            <path d="${imperialCrestPath}"/>
                        </svg>
                        <div class="rank-pips">${pips}</div>
                    </div>
                    <div class="card-data">
                        <div class="data-header">
                        <div class="org-stack">
                                <div class="card-org">${person.displayOrg}</div>
                                <div class="faction-tag" style="background:${fData.color};">${person.faction}</div>
                            </div>
                            <div style="font-family:'Share Tech Mono'; color:#000; font-size:0.8rem; font-weight:bold;">ID-${techID}</div>
                        </div>
                        <div class="card-name">${person.name}</div>
                        <div class="card-title">${person.title}</div>
                        
                        <div class="stats-bars">
                            <div class="stat-line">
                                <span class="stat-label">LOYALTY</span>
                                <div class="stat-track"><div class="stat-fill" style="width: ${person.loyalty}%"></div></div>
                            </div>
                            <div class="stat-line">
                                <span class="stat-label">INFLUENCE</span>
                                <div class="stat-track"><div class="stat-fill" style="width: ${person.influence}%"></div></div>
                            </div>
                        </div>
                        <div style="font-size:0.75rem; color:#444; line-height:1.4;">${summaryDesc}</div>
                    </div>
                </div>
                <div class="tech-specs">
                     <span>LOC: ${person.location.toUpperCase()}</span>
                     <span>STATUS: ${person.status.toUpperCase()}</span>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function filterData(type, btn, value) {
        // UI State
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // Logic
        let filtered = [];
        if (type === 'all') {
            filtered = personnelConfig;
        } else if (type === 'org') {
            filtered = personnelConfig.filter(p => p.org === value);
        } else if (type === 'faction') {
            filtered = personnelConfig.filter(p => p.faction === value);
        }
        
        renderCards(filtered);
        addLog(`Filtering database: ${value || 'ALL'}...`);
    }

    function updateFilterCounts() {
        document.getElementById('count-all').innerText = personnelConfig.length;
        document.getElementById('count-mil').innerText = personnelConfig.filter(p => p.org === 'High Command').length;
        document.getElementById('count-min').innerText = personnelConfig.filter(p => p.org === 'Ministry').length;
        document.getElementById('count-cou').innerText = personnelConfig.filter(p => p.org === 'Ruling Council').length;
        document.getElementById('count-com').innerText = personnelConfig.filter(p => p.org === 'COMPNOR').length;
        document.getElementById('count-sec').innerText = personnelConfig.filter(p => p.org === 'Security').length;
        document.getElementById('count-pro').innerText = personnelConfig.filter(p => p.org === 'Provincial').length;
    }

    // --- MODAL ---
    
    function openModal(index) {
        const data = personnelConfig[index];
        const fData = factionData[data.faction] || { color: "#333", quote: "Unknown", agenda: "Classified" };
        
        document.getElementById('m-name').innerText = data.name;
        document.getElementById('m-title').innerText = data.title;
        document.getElementById('m-loc').innerText = data.location.toUpperCase();
        document.getElementById('m-loyalty').innerText = data.loyalty + "%";
        
        // Generate Fake Loyalty Graph
        const graphCon = document.getElementById('loyalty-graph');
        let graphHtml = '';
        for(let i=0; i<15; i++) {
            // Trend towards their actual loyalty
            const h = Math.max(10, Math.min(100, data.loyalty + (Math.random()*40 - 20))); 
            graphHtml += `<div class="l-bar" style="height:${h}%;"></div>`;
        }
        graphCon.innerHTML = graphHtml;

        const fNameEl = document.getElementById('m-faction-name');
        fNameEl.innerText = data.faction;
        fNameEl.style.color = "#000";
        document.getElementById('m-faction-quote').innerText = `"${fData.quote}"`;
        document.getElementById('m-faction-agenda').innerText = fData.agenda;

        // Image
        const imgEl = document.getElementById('m-img');
        const svgContainer = document.getElementById('m-svg-container');
        const svgPath = document.getElementById('m-svg-path');
        
        if (data.image && data.image.trim() !== "") {
            imgEl.style.display = 'block';
            svgContainer.style.display = 'none';
            imgEl.src = data.image;
            imgEl.onerror = () => { imgEl.style.display='none'; svgContainer.style.display='flex'; svgPath.setAttribute('d', imperialCrestPath); };
        } else {
            imgEl.style.display = 'none';
            svgContainer.style.display = 'flex';
            svgPath.setAttribute('d', imperialCrestPath);
        }

        // NO DECRYPT EFFECT - Plain Text
        const descEl = document.getElementById('m-desc');
        descEl.innerText = data.desc;

        // Reset Transform for Dragging
        const modal = document.getElementById('modal-container');
        modal.style.transform = "translate(0,0)";

        document.getElementById('modal-overlay').classList.add('active');
        addLog(`Accessing file: ${data.name} [SECURE]`);
    }

    function closeModal() {
        document.getElementById('modal-overlay').classList.remove('active');
    }

    // --- SYSTEM FX ---
    function startLogs() {
        setInterval(() => addLog(), 2500);
        for(let i=0; i<4; i++) addLog();
    }

    const logMsgs = [
        "Scanning Sector 4...", "Encrypted Transmission: VERIFIED", "Unit 774-A reporting in.",
        "Holonet relay stabilized.", "Rebel activity detected in Sector 9.", "TIE Squadron deployed.",
        "Background radiation: NORMAL", "Updating personnel manifest...", "Connection secured",
        "Auth token refreshed.", "Compiling analytics...", "Hyperdrive diagnostic complete."
    ];

    function addLog(specificText = null) {
        const con = document.getElementById('system-log');
        const entry = document.createElement('div');
        entry.className = 'log-entry new';
        
        const text = specificText || logMsgs[Math.floor(Math.random() * logMsgs.length)];
        const time = new Date().toLocaleTimeString([], {hour12: false});
        entry.innerText = `[${time}] ${text}`;
        
        if(!specificText && Math.random() > 0.85) {
            entry.className += ' alert';
            entry.innerText = `[${time}] ALERT: ${text.toUpperCase()}`;
        }

        con.appendChild(entry);
        con.scrollTop = con.scrollHeight;
        setTimeout(() => entry.classList.remove('new'), 500);
        if(con.children.length > 20) con.removeChild(con.firstChild);
    }

    function initTicker() {
        const t = document.getElementById('ticker-content');
        let html = '';
        headlines.forEach(h => html += `<div class="ticker-item">${h}</div>`);
        t.innerHTML = html;
    }

    function runBootSequence() {
        const bootScreen = document.getElementById('boot-screen');
        const lines = [
            document.getElementById('boot-1'), document.getElementById('boot-2'),
            document.getElementById('boot-3'), document.getElementById('boot-4')
        ];
        let delay = 0;
        lines.forEach((line) => {
            line.style.display = 'none';
            setTimeout(() => { line.style.display = 'block'; }, delay);
            delay += 800;
        });
        setTimeout(() => {
            bootScreen.style.opacity = '0';
            setTimeout(() => { bootScreen.style.display = 'none'; }, 600);
        }, delay + 1000);
    }

    window.onload = init;
    document.addEventListener('keydown', (e) => { if(e.key === "Escape") closeModal(); });

</script>
</body>
</html>
